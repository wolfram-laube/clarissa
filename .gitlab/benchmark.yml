# Runner Benchmark Jobs - Full Matrix
# 4 Machines Ã— 3 Executors = 12 Runners

.benchmark_base:
  stage: test
  timeout: 10 minutes
  script:
    - echo "=== Runner Benchmark ==="
    - echo "Runner: $CI_RUNNER_DESCRIPTION"
    - echo "Host: $(hostname)"
    - date
    - echo "--- CPU Benchmark (primes to 500k) ---"
    - python3 -c "import time; s=time.time(); n=500000; sieve=[1]*n; [sieve.__setitem__(i,0) for p in range(2,int(n**.5)+1) if sieve[p] for i in range(p*p,n,p)]; print(f'{sum(sieve)-2} primes in {time.time()-s:.2f}s')"
    - echo "--- Disk I/O (write 100MB) ---"
    - dd if=/dev/zero of=/tmp/testfile bs=1M count=100 2>&1 || true
    - rm -f /tmp/testfile
    - echo "=== Done ==="
    - date
  rules:
    - when: manual

# ============ Mac #1 ============
benchmark-mac-group-shell:
  extends: .benchmark_base
  tags: [mac-group-shell]

benchmark-mac-docker:
  extends: .benchmark_base
  tags: [mac-docker]
  image: python:3.11-slim

benchmark-mac-k8s:
  extends: .benchmark_base
  tags: [mac-k8s]
  image: python:3.11-slim

# ============ Mac #2 ============
benchmark-mac2-shell:
  extends: .benchmark_base
  tags: [mac2-shell]

benchmark-mac2-docker:
  extends: .benchmark_base
  tags: [mac2-docker]
  image: python:3.11-slim

benchmark-mac2-k8s:
  extends: .benchmark_base
  tags: [mac2-k8s]
  image: python:3.11-slim

# ============ Linux Yoga ============
benchmark-linux-shell:
  extends: .benchmark_base
  tags: [linux-shell]

benchmark-linux-docker:
  extends: .benchmark_base
  tags: [linux-docker]
  image: python:3.11-slim

benchmark-linux-k8s:
  extends: .benchmark_base
  tags: [linux-k8s]
  image: python:3.11-slim

# ============ GCP VM ============
benchmark-gcp-shell:
  extends: .benchmark_base
  tags: [gcp-shell]

benchmark-gcp-docker:
  extends: .benchmark_base
  tags: [gcp-docker]
  image: python:3.11-slim

benchmark-gcp-k8s:
  extends: .benchmark_base
  tags: [gcp-k8s]
  image: python:3.11-slim
