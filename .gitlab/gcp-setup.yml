
gcp:fix-permissions:
  stage: .pre
  tags: [mac-group-shell]
  script:
    - echo "ðŸ”§ Fixing GCP Runner permissions..."
    - |
      gcloud compute ssh gitlab-runner --zone=europe-west3-a --command='
        echo "=== Creating builds directory ==="
        sudo mkdir -p /home/gitlab-runner/builds
        sudo chown -R gitlab-runner:gitlab-runner /home/gitlab-runner
        
        echo "=== Updating runner config ==="
        sudo sed -i "s|/home/wolfram_e_laube|/home/gitlab-runner|g" /etc/gitlab-runner/config.toml || true
        
        echo "=== Current config ==="
        sudo cat /etc/gitlab-runner/config.toml
        
        echo "=== Restarting runner ==="
        sudo systemctl restart gitlab-runner
        sudo gitlab-runner status
      '
  rules:
    - when: manual
