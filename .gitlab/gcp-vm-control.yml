# GCP VM Control Jobs
# Manually start/stop the GCP runner VM to save costs

gcp-vm-start:
  stage: deploy
  tags: [mac, shell]
  script:
    - echo "Starting GCP Runner VM..."
    - gcloud compute instances start gitlab-runner --zone=europe-west3-a --project=myk8sproject-207017
    - echo "Waiting for VM to be ready..."
    - sleep 30
    - gcloud compute instances describe gitlab-runner --zone=europe-west3-a --project=myk8sproject-207017 --format="table(name,status,networkInterfaces[0].accessConfigs[0].natIP)"
    - echo "✅ GCP Runner VM started"
  rules:
    - when: manual
  allow_failure: true

gcp-vm-stop:
  stage: deploy
  tags: [mac, shell]
  script:
    - echo "Stopping GCP Runner VM..."
    - gcloud compute instances stop gitlab-runner --zone=europe-west3-a --project=myk8sproject-207017
    - echo "✅ GCP Runner VM stopped (saving ~$0.02/hour)"
  rules:
    - when: manual
  allow_failure: true

gcp-vm-status:
  stage: deploy
  tags: [mac, shell]
  script:
    - echo "=== GCP Runner VM Status ==="
    - gcloud compute instances describe gitlab-runner --zone=europe-west3-a --project=myk8sproject-207017 --format="table(name,status,machineType.basename(),networkInterfaces[0].accessConfigs[0].natIP)"
  rules:
    - when: manual
  allow_failure: true
